S3 datasets
===========

Since the end of 2017, IMDb stopped updating the plain text data files, and
started distributing `datasets`_ that are much easier to parse, but also
contain much less information. You can access this data in IMDbPY
by first importing them into a database.

Here are the steps:

#. Create a database (let's call it ``imdb``), using a database server
   supported by `SQLAlchemy`_. Please use a collation like ``utf8_unicode_ci``.

#. Install the system libraries needed to access that database, such as
   psycopg2 for PostgreSQL or pymysql for MySQL. These are NOT included
   in SQLAlchemy.

#. Download the files from https://datasets.imdbws.com/, and put all of them
   in the same directory.

#. Import the data using the ``bin/s32imdbpy.py`` script using the command::

      s32imdbpy.py /path/to/the/tsv.gz/files/ URI

   where *URI* is the identifier used to access the SQL database, as in
   ``postgres://user:password@localhost/imdb``::

      s32imdbpy.py ~/Download/imdb-s3-dataset-2018-02-07/ \
          postgres://user:password@localhost/imdb

Once the import is finished -which should take about an hour or less
on a modern system, you will have a SQL database with all the information.
Running the script again will drop the current tables and import
the data again.

After this point, you can just use the same API of IMDbPY:

.. code-block:: python

   from imdb import IMDb

   ia = IMDb('s3', 'postgres://user:password@localhost/imdb')

   results = ia.search_movie('the matrix')
   for result in results:
       print(result.movieID, result)

   matrix = results[0]
   ia.update(matrix)
   print(sorted(matrix.keys()))


.. _datasets: https://www.imdb.com/interfaces/
.. _SQLAlchemy: https://www.sqlalchemy.org/
